(self.webpackChunkpz_frontend=self.webpackChunkpz_frontend||[]).push([[2196],{7373:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r});var s=n(3645),a=n.n(s)()((function(t){return t[1]}));a.push([t.id,"\n.chat[data-v-9112d65a] {\n\theight: calc(100vh - 186px);\n\toverflow-y: auto;\n\tpadding-right: 15px;\n\t-webkit-transition: color .35s ease;\n\t-o-transition: color .35s ease;\n\ttransition: color .35s ease;\n\tcolor: rgba(0, 0, 0, 0);\n}\n@media screen and (max-width: 960px) {\n.chat[data-v-9112d65a] {\n\t\theight: calc(100vh - 178px);\n}\n}\n.chat[data-v-9112d65a]:hover {\n\tcolor: #a3a3a3;\n}\n*[data-v-9112d65a]::-webkit-scrollbar,\n*[data-v-9112d65a]::-webkit-scrollbar-thumb {\n\twidth: 26px;\n\tborder-radius: 13px;\n\tbackground-clip: padding-box;\n\tborder: 10px solid transparent;\n}\n*[data-v-9112d65a]::-webkit-scrollbar-thumb {        \n\t-webkit-box-shadow: inset 0 0 0 10px;        \n\t        box-shadow: inset 0 0 0 10px;\n}\n.sendButton[data-v-9112d65a] {\n\tmargin-top: -8px;\n\tmargin-right: 16px;\n}\n.backButton[data-v-9112d65a] {\n\theight: 55px;\n}\n.backButton i[data-v-9112d65a] {\n\tcolor: #757575 !important;\n}\n.emoji-picker[data-v-9112d65a] {\n\tmargin-top: -6px;\n\tmargin-right: 3px;\n}\n",""]);const r=a},1136:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r});var s=n(3645),a=n.n(s)()((function(t){return t[1]}));a.push([t.id,"\n.conversation-list[data-v-11453df2] {\n\tbackground: rgba(0,0,0,0);\n\tmax-height: calc(100vh - 186px);\n}\n.col-br[data-v-11453df2] {\n\tborder-right: 1px solid #0000001f;\n\tbackground: white;\n}\n.v-application.theme--dark .col-br[data-v-11453df2] {\n\tbackground-color: #1e1e1e;\n}\n.v-application:not(.theme--dark) .active-cl[data-v-11453df2] {\n\tbackground-color: #f7f7f7 !important;\n}\n.v-application.theme--dark .active-cl[data-v-11453df2] {\n\tbackground-color: #2f2f2f !important;\n}\n.mE-conversation-list[data-v-11453df2] {\n\toverflow: auto;\n\theight: calc(100vh - 64px) !important;\n}\n@media screen and (max-width: 960px) {\n.mE-conversation-list[data-v-11453df2] {\n\t\theight: calc(100vh) !important;\n}\n}\n.ih-info[data-v-11453df2] {\n\tcolor: #ffffff;\n\tfont-size: 14px;\n\tbackground: #452d99;\n\tpadding: 7px;\n}\n",""]);const r=a},1778:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r});var s=n(3645),a=n.n(s)()((function(t){return t[1]}));a.push([t.id,"\n.message[data-v-58d93071] {\n\twidth: 100%;\n\tpadding-bottom: 20px;\n\tdisplay: -webkit-box;\n\tdisplay: -webkit-flex;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n}\n.message-content[data-v-58d93071] {\n\twidth: 100%;\n\tdisplay: -webkit-box;\n\tdisplay: -webkit-flex;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n}\n.message-text[data-v-58d93071] {\n\tbackground: #e8e8e8;\n\tcolor: black;\n\tpadding: 5px 20px;\n\tborder-radius: 6px;\n\tfont-weight: 300;\n\tfont-size: 14px;\n\tmargin-left: 20px;\n\tposition: relative;\n}\n.v-application.theme--dark .message-text[data-v-58d93071] {\n\tbackground: #121212;\n\tcolor: white;\n}\n.message-text p[data-v-58d93071] {\n\tmargin: 1em 0em 0.7em 0em;\n}\n.received[data-v-58d93071] {\n\t-webkit-box-pack: end;\n\t-webkit-justify-content: end;\n\t    -ms-flex-pack: end;\n\t        justify-content: end;\n}\n.sent[data-v-58d93071] {\n\t-webkit-box-pack: end;\n\t-webkit-justify-content: flex-end;\n\t    -ms-flex-pack: end;\n\t        justify-content: flex-end;\n}\n.sent .message-text[data-v-58d93071] {\n\tbackground: #4f78e5;\n}\n.message-timestamp[data-v-58d93071] {\n\tfloat: right;\n\tcolor: #9c9c9c;\n\tfont-size: 12px;\n}\n.message.icon .message-text[data-v-58d93071] {\n\tbackground: none !important;\n}\n.message.icon .message-text p[data-v-58d93071] {\n\tfont-size: 34px;\n\tmargin-top: 10px;\n\tmargin-bottom: 10px;\n}\n",""]);const r=a},2196:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>Q});var s=n(2137),a=n(7757),r=n.n(a),o=n(1313),i=n(3960),c=n(4161);const l={name:"ConversationList",props:{conversations:{type:Array,default:[]}},components:{SearchUserDialog:i.Z,UserAvatar:c.Z},data:function(){return{selected:null,dialogAddConversation:!1}},watch:{selected:function(t){var e=this.conversations[t];this.$emit("selected",e)}},methods:{infiniteHandler:function(t){this.$parent.fetchConversationsData(t)},select:function(t){this.selected=t},createNewConversation:function(t){this.$parent.createNewConversation(t)},openAddConversationDialog:function(){this.dialogAddConversation=!0},reset:function(){this.select(null),this.$refs.InfiniteLoading&&this.$refs.InfiniteLoading.stateChanger.reset()}}};var d,u=n(3379),v=n.n(u),f=n(687),p=n.n(f),g=0,m={injectType:"lazyStyleTag",insert:"head",singleton:!1},h={};h.locals=p().locals||{},h.use=function(){return g++||(d=v()(p(),m)),h},h.unuse=function(){g>0&&!--g&&(d(),d=null)};var x=n(1900);const _=(0,x.Z)(l,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-col",{staticClass:"flex-grow-1 flex-shrink-0 col-br mE-conversation-list",attrs:{cols:"12",md:"3"}},[n("v-app-bar",{attrs:{flat:""}},[n("v-toolbar-title",{staticClass:"title"},[t._v("\n\t\t\t"+t._s(t.$t("messages.index.conversations"))+" \n\t\t")]),t._v(" "),n("v-spacer"),t._v(" "),n("v-tooltip",{attrs:{left:""},scopedSlots:t._u([{key:"activator",fn:function(e){return e.on,e.attrs,[n("v-btn",{attrs:{icon:""},on:{click:t.openAddConversationDialog}},[n("v-icon",[t._v("fas fa-plus")])],1)]}}])},[t._v(" "),n("span",[t._v(t._s(t.$t("messages.add.title")))])])],1),t._v(" "),n("v-list",{staticClass:"conversation-list",attrs:{"two-line":""}},[n("v-list-item-group",{attrs:{"active-class":"active-cl"},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}},[t._l(t.conversations,(function(e,s){return[e.user2?n("v-list-item",{key:"conversation-"+s},[n("v-list-item-avatar",[n("UserAvatar",{attrs:{firstname:e.user2.firstname,surname:e.user2.surname}})],1),t._v(" "),n("v-list-item-content",[n("v-list-item-title",[t._v(t._s(e.user2.firstname)+" "+t._s(e.user2.surname))]),t._v(" "),n("v-list-item-subtitle",[t._v(t._s(e.lastMessage))])],1)],1):t._e(),t._v(" "),s<t.conversations.length-1?n("v-divider"):t._e()]})),t._v(" "),n("infinite-loading",{ref:"InfiniteLoading",on:{infinite:t.infiniteHandler}},[n("div",{attrs:{slot:"spinner"},slot:"spinner"},[n("div",{staticClass:"ih-info"},[t._v(t._s(t.$t("data.loading")))])]),t._v(" "),n("div",{attrs:{slot:"no-more"},slot:"no-more"},[n("div",{staticClass:"ih-info"},[t._v(t._s(t.$t("data.noMore")))])]),t._v(" "),n("div",{attrs:{slot:"no-results"},slot:"no-results"},[n("div",{staticClass:"ih-info"},[t._v(t._s(t.$t("data.noMore")))])])])],2)],1),t._v(" "),n("SearchUserDialog",{on:{selected:t.createNewConversation},scopedSlots:t._u([{key:"header",fn:function(){return[t._v("\n\t\t\t"+t._s(t.$t("messages.add.title"))+"\n\t\t")]},proxy:!0}]),model:{value:t.dialogAddConversation,callback:function(e){t.dialogAddConversation=e},expression:"dialogAddConversation"}})],1)}),[],!1,null,"11453df2",null).exports,y={name:"MessageText",props:{message:{type:String,required:!0},firstname:{type:String,required:!0},surname:{type:String,required:!0},sent:{type:Boolean,required:!0},date:{type:String,required:!0},type:{type:String,required:!0}},computed:{initials:function(){return this.userInitials({firstname:this.firstname,surname:this.surname})},isIcon:function(){return"icon"===this.type}}};var b,C=n(5979),k=n.n(C),w=0,$={injectType:"lazyStyleTag",insert:"head",singleton:!1},L={};L.locals=k().locals||{},L.use=function(){return w++||(b=v()(k(),$)),L},L.unuse=function(){w>0&&!--w&&(b(),b=null)};const P=(0,x.Z)(y,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:{message:!0,icon:t.isIcon}},[[n("div",{class:{"message-content":!0,sent:t.sent,received:!t.sent}},[n("div",{class:{"message-text":!0,"white--text primary":t.sent},attrs:{elevation:"1"}},[n("p",[t._v(t._s(t.message))]),t._v(" "),t.isIcon?t._e():n("div",{staticClass:"message-timestamp"},[t._v("\n\t\t\t\t\t"+t._s(t.date)+"\n\t\t\t\t")])])])]],2)}),[],!1,null,"58d93071",null).exports;var Z=n(7247),j=n(9550),M=(n(8013),n(1610),n(8777));const A={name:"Conversation",props:{conversation:{type:Object,default:null},messages:{type:Array,default:[]}},components:{MessageText:P,TwemojiPicker:Z.xP},computed:{mini:function(){return this.$vuetify.breakpoint.smAndDown},emojiDataAll:function(){return j},emojiGroups:function(){return M}},data:function(){return{message:""}},watch:{messages:function(t,e){var n=this;this.$nextTick((function(){n.scrollToBottom()}))}},methods:{infiniteHandler:function(t){this.conversation?t&&this.$parent.fetchConversationReplyData(t):t.complete()},sendMessage:function(){this.conversation&&(this.$parent.sendMessage(this.message),this.message="")},scrollToBottom:function(){var t=this.$refs.chat;t.scrollTop=t.scrollHeight-t.clientHeight},removeSelectedConversation:function(){this.$parent.selectConversation(null)},reset:function(){this.scrollToBottom(),this.$refs.infiniteLoading&&this.$refs.infiniteLoading.stateChanger.reset()},addEmoji:function(t){this.message+=t}}};var S,T=n(4006),D=n.n(T),B=0,E={injectType:"lazyStyleTag",insert:"head",singleton:!1},U={};U.locals=D().locals||{},U.use=function(){return B++||(S=v()(D(),E)),U},U.unuse=function(){B>0&&!--B&&(S(),S=null)};const R=(0,x.Z)(A,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-col",{staticClass:"flex-grow-1 flex-shrink-0",attrs:{cols:"12",md:"9"}},[t.mini?n("v-btn",{staticClass:"backButton",attrs:{block:"",elevation:"0",fab:"",text:"",tile:"","x-large":""},on:{click:t.removeSelectedConversation}},[n("v-icon",[t._v("fa-arrow-left")])],1):t._e(),t._v(" "),n("v-card",{staticClass:"mx-auto rounded-0",attrs:{elevation:"0"}},[n("v-card-text",[n("div",{ref:"chat",staticClass:"chat"},[t.conversation?[n("infinite-loading",{ref:"infiniteLoading",attrs:{direction:"top"},on:{infinite:t.infiniteHandler}},[n("div",{attrs:{slot:"spinner"},slot:"spinner"},[n("div",{staticClass:"ih-info"},[t._v(t._s(t.$t("data.loading")))])]),t._v(" "),n("div",{attrs:{slot:"no-more"},slot:"no-more"},[n("div",{staticClass:"ih-info"},[t._v(t._s(t.$t("data.noMore")))])]),t._v(" "),n("div",{attrs:{slot:"no-results"},slot:"no-results"},[n("div",{staticClass:"ih-info"},[t._v(t._s(t.$t("data.noMore")))])])]),t._v(" "),t._l(t.messages,(function(t,e){return[n("MessageText",{attrs:{firstname:"test",surname:"test",sent:t.currentUser,message:t.message,date:t.date,type:t.type}})]}))]:t._e()],2)]),t._v(" "),n("v-card-text",{staticClass:"flex-shrink-1"},[n("v-text-field",{attrs:{label:t.$t("messages.send.enterMessage"),type:"text","no-details":"",outlined:"","hide-details":"",disabled:!t.conversation},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage(e)}},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("div",{staticClass:"emoji-picker"},[n("TwemojiPicker",{attrs:{emojiData:t.emojiDataAll,emojiGroups:t.emojiGroups,skinsSelection:!0,searchEmojisFeat:!1,isLoadingLabel:"Loading..."},on:{emojiUnicodeAdded:t.addEmoji}})],1)]},proxy:!0},{key:"append-outer",fn:function(){return[n("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on,a=e.attrs;return[n("v-btn",t._g(t._b({staticClass:"sendButton",attrs:{icon:""},on:{click:t.sendMessage}},"v-btn",a,!1),s),[n("v-icon",[t._v("fa-share")])],1)]}}])},[t._v(" "),n("span",[t._v(t._s(t.$t("buttons.actions.send")))])])]},proxy:!0}]),model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1)],1)],1)}),[],!1,null,"9112d65a",null).exports;var z=n(6692),I=n(6610),N=n(5991),q=n(5255),H=n(3724),O=n(7608),F=n(3686);var G=function(t){(0,q.Z)(a,t);var e,n,s=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,s=(0,O.Z)(e);if(n){var a=(0,O.Z)(this).constructor;t=Reflect.construct(s,arguments,a)}else t=s.apply(this,arguments);return(0,H.Z)(this,t)});function a(){return(0,I.Z)(this,a),s.apply(this,arguments)}return(0,N.Z)(a,[{key:"resource",value:function(){return"conversation"}}]),a}(F.Z);var W=function(t){(0,q.Z)(a,t);var e,n,s=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,s=(0,O.Z)(e);if(n){var a=(0,O.Z)(this).constructor;t=Reflect.construct(s,arguments,a)}else t=s.apply(this,arguments);return(0,H.Z)(this,t)});function a(){return(0,I.Z)(this,a),s.apply(this,arguments)}return(0,N.Z)(a,[{key:"resource",value:function(){return"conversation_reply"}}]),a}(F.Z),J=new o.Z;const K={ititle:"messages.index.title",components:{ConversationList:_,Conversation:R,UiProgress:z.Z},data:function(){return{loading:!1,selectedConversation:null,messages:[],conversations:[],conversationsPage:0,conversationsLastPage:0,messagesPage:0,messagesLastPage:0}},computed:{mini:function(){return this.$vuetify.breakpoint.smAndDown},showConversationList:function(){return this.mini&&!this.selectedConversation||!this.mini},showConversation:function(){return this.mini&&!!this.selectedConversation||!this.mini}},methods:{fetchConversationsData:function(t){var e=this;return(0,s.Z)(r().mark((function n(){var s,a,o,i;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=e,e.loading=!0,n.prev=2,n.next=5,G.page(s.conversationsPage+1).get();case 5:for(a=n.sent,o=a.data,i=0;i<o.length;i++)s.conversations.push({id:o[i].id,lastMessage:s.getLastMesage(o[i]),user2:s.getUser(o[i])});s.conversationsLastPage=s.getAllPagesFromLast(a.last_page),s.conversationsPage+=1,s.conversationsLastPage<=s.conversationsPage?t.complete():t.loaded(),n.next=18;break;case 14:n.prev=14,n.t0=n.catch(2),t.complete(),s.$toast.error(s.$t("messages.index.error"),s.$t("notifications.error"));case 18:return n.prev=18,s.loading=!1,n.finish(18);case 21:case"end":return n.stop()}}),n,null,[[2,14,18,21]])})))()},fetchConversationReplyData:function(t){var e=this;return(0,s.Z)(r().mark((function n(){var s,a,o,i,c,l,d;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=e,e.loading=!0,n.prev=2,a=s.selectedConversation.id,n.next=6,W.custom("/conversation_reply/".concat(a)).page(s.messagesPage+1).get();case 6:for(o=n.sent,i=o.data,c=[],l=s.$store.getters["auth/currentUser"],i.length,d=i.length-1;d>=0;d--)c.push({id:i[d].id,message:i[d].reply,date:s.formatDate(i[d].reply_time),currentUser:l.id==i[d].reply_user_id,type:s.isOnlyEmoji(i[d].reply)?"icon":"text"});c&&0==s.messages.length?s.messages=c:c&&s.messages.length>0&&(s.messages=e._.concat(c,s.messages)),s.messagesLastPage=s.getAllPagesFromLast(o.last_page),s.messagesPage+=1,s.messagesLastPage<=s.messagesPage?t.complete():t.loaded(),n.next=22;break;case 18:n.prev=18,n.t0=n.catch(2),t.complete(),s.$toast.error(s.$t("messages.index.error2"),s.$t("notifications.error"));case 22:return n.prev=22,s.loading=!1,n.finish(22);case 25:case"end":return n.stop()}}),n,null,[[2,18,22,25]])})))()},createNewConversation:function(t){var e=this;return(0,s.Z)(r().mark((function n(){var s,a,o;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=e,n.prev=1,a=new G({user_two:t.id}),n.next=5,a.save();case 5:if("Conversation already exists"!=(o=n.sent).msg){n.next=11;break}return s.$toast.error(s.$t("messages.add.error2"),s.$t("notifications.error")),n.abrupt("return");case 11:if("Could not make conversation with the same user"!=o.msg){n.next=14;break}return s.$toast.error(s.$t("messages.add.error3"),s.$t("notifications.error")),n.abrupt("return");case 14:s.$toast.success(s.$t("messages.add.success"),s.$t("notifications.success")),s.resetConversationList(),n.next=21;break;case 18:n.prev=18,n.t0=n.catch(1),s.$toast.error(s.$t("messages.add.error"),s.$t("notifications.error"));case 21:case"end":return n.stop()}}),n,null,[[1,18]])})))()},getLastMesage:function(t){return t.last_reply[0]?t.last_reply[0].reply:""},getUser:function(t){var e=t.user_two;return e?(e.initials=this.userInitials({firstname:e.firstname,surname:e.surname}),e.avatarColor=J.hex(e.firstname),e):null},startConversationWith:function(t){this.resetConversation(),this.messages=[],this.conversationsPage=0,this.conversationsLastPage=0,this.messagesPage=0,this.messagesLastPage=0,this.selectedConversation=t},saveNewMessage:function(t,e,n){this.messages.push({id:t,message:e,date:this.formatDate(n),currentUser:!0,type:this.isOnlyEmoji(e)?"icon":"text"}),this.selectedConversation.lastMessage=e},sendMessage:function(t){var e=this;return(0,s.Z)(r().mark((function n(){var s,a,o,i;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=e,n.prev=1,a={reply:t,conv_id:s.selectedConversation.id},o=new W(a),n.next=6,o.save();case 6:(i=n.sent).conv_id==s.selectedConversation.id&&s.saveNewMessage(i.id,t,i.reply_time),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(1),s.$toast.error(s.$t("messages.send.error"),s.$t("notifications.error"));case 13:case"end":return n.stop()}}),n,null,[[1,10]])})))()},selectConversation:function(t){this.$refs["Chat-ConversationList"].select(t)},resetConversation:function(){this.$refs["Chat-Conversation"].reset()},resetConversationList:function(){this.conversations=[],this.conversationsPage=0,this.conversationsLastPage=0,this.$refs["Chat-ConversationList"].reset()}}},Q=(0,x.Z)(K,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("UiProgress",{attrs:{loading:t.loading}}),t._v(" "),n("v-container",{staticClass:"fill-height pa-0",attrs:{fluid:""}},[n("v-row",{staticClass:"no-gutters"},[n("ConversationList",{directives:[{name:"show",rawName:"v-show",value:t.showConversationList,expression:"showConversationList"}],ref:"Chat-ConversationList",attrs:{conversations:t.conversations},on:{selected:t.startConversationWith}}),t._v(" "),n("Conversation",{directives:[{name:"show",rawName:"v-show",value:t.showConversation,expression:"showConversation"}],ref:"Chat-Conversation",attrs:{conversation:t.selectedConversation,messages:t.messages}})],1)],1)],1)}),[],!1,null,null,null).exports},4006:(t,e,n)=>{var s=n(7373);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals),(0,n(5346).Z)("4eea8472",s,!0,{})},687:(t,e,n)=>{var s=n(1136);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals),(0,n(5346).Z)("b48b74b2",s,!0,{})},5979:(t,e,n)=>{var s=n(1778);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals),(0,n(5346).Z)("191714de",s,!0,{})}}]);